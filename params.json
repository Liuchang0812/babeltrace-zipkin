{
  "name": "End-to-end Performance Visualization in Ceph ",
  "tagline": "Google Summer of Code 2016",
  "body": "### Background\r\n[Ceph](http://ceph.com/) is a software-defined storage solution that provides object storage, block storage and a filesystem. It was designed to provide excellent performance, reliability and scalability.\r\n\r\nCeph participated in [Google Summer of Code 2016](https://summerofcode.withgoogle.com/) as a mentoring organization. One of the accepted projects was this one, related to performance visualization of Ceph's components using the LTTng-based [blkin library](https://github.com/linuxbox2/blkin) and [Twitter Zipkin](https://github.com/openzipkin/zipkin).\r\n\r\n### Description\r\n\r\nCeph provides the [librbd library](http://docs.ceph.com/docs/master/rbd/rbd/) to interact with block storage, which uses [librados](http://docs.ceph.com/docs/master/rados/api/librados/) to interact with the storage cluster. Code in librbd and librados needs to be instrumented with blkin to record events of interest to developers, using timestamp and key-value annotations.\r\n\r\nThis project builds on previous tracing efforts that use blkin, to extend it to librbd and to [fio rbd engine](https://github.com/axboe/fio/blob/master/engines/rbd.c) where trace information is initialized and passed to librbd. This project also puts up to date the tools to get the collected traces and send them to a Zipkin server.\r\n\r\n![screenshot](https://github.com/vears91/githubpages/raw/master/trace.png)\r\n_Events can be traced and visualized in Zipkin, including timestamps and key-value annotations (not all of the events of the screenshot are currently implemented)_\r\n\r\n### Work done\r\n\r\n1. **Babeltrace-zipkin:** The previous babeltrace plugins needed to be updated to work with recent versions of Zipkin. \r\n  * Use thriftpy for compatibility with Python3.\r\n  * Fix the Thrift specification used to communicate with Zipkin.\r\n  * Provide scripts to install dependencies with support for Ubuntu and Fedora.\r\n  * See [Github commits](https://github.com/vears91/babeltrace-zipkin/commits/master)\r\n\r\n\r\n2. **blkin:** Some minor features were added to blkin.\r\n  * Support for core annotations was added.\r\n  * Initialization for trace information structs (i.e. to initialize trace information in fio rbd engine).\r\n  * See pull requests [1](https://github.com/linuxbox2/blkin/pull/1) and [2](https://github.com/linuxbox2/blkin/pull/2)\r\n\r\n\r\n3. **fio rbd engine:** Support was added to initialize trace information and pass it to librbd from fio rbd engine.\r\n  * Add configure support to disable or enable fio rbd engine with blkin.\r\n  * Use rbd_aio_write_traced and rbd_aio_read_traced to pass the trace information to librbd.\r\n  * See [Commit](https://github.com/axboe/fio/commit/a4c4c3460bd556cdb0aadc71d006556530144d01)\r\n\r\n\r\n4. **Ceph:** Trace information was passed along from librbd to librados for aio reads and writes.\r\n  * Add rbd_aio_write_traced and rbd_aio_read_traced functions to librbd that take trace information as one of the parameters.\r\n  * Extend the librados API to take trace information from librbd\r\n  * See commits [here](https://github.com/vears91/ceph/commits/wip-rebase-gsoc?author=vear91) and [here](https://github.com/vears91/ceph/commits/wip-rebase-gsoc?author=vh4x).\r\n\r\n\r\n### Getting started\r\n\r\nTo see traces initialized from fio rbd engine:\r\n\r\n  1. Install Zipkin, LTTng, babeltrace-zipkin and related dependencies. You might use one of the provided [scripts](https://github.com/vears91/babeltrace-zipkin/tree/master/setup) or refer to this [documentation] (https://github.com/vears91/babeltrace-zipkin/blob/master/steps.md).\r\n  2. Build and install Ceph with blkin support (pass -DWITH_BLKIN=ON to cmake configuration).\r\n  3. Get [fio](https://github.com/axboe/fio) and configure (`LDFLAGS=\"-Lpath/to/build/lib -Wl,-rpath,path/to/build/lib\" ./configure --extra-cflags=\"-I/usr/local/include/\"`) and build it with rbd support. If the blkin dependencies and the right version of librbd is installed in your system during the configure step you should see that blkin rbd tracing is enabled.\r\n  4. Make sure Zipkin is running.\r\n  5. Enable zipkin events and start an LTTng session `lttng create && lttng enable-event zipkin:timestamp && lttng start`.\r\n  6. Run fio providing the location of your cluster's configuration file in the CEPH_CONF variable.\r\n  7. Stop the tracing session and use babeltrace-zipkin to send the traces to Zipkin `python3 babeltrace_zipkin.py location/to/traces/ust/uid/1000/64-bit/ -s serverIp -p zipkinPort`\r\n\r\n\r\n### Authors and Contributors\r\n\r\nVictor Araujo (@vears91).\r\n\r\nAli Maredia (@alimaredia) was the mentor from Red Hat that supervised the project. Thank you very much for your support.\r\nSpecial thanks too for the valuable help of Casey Bodley (@cbodley) and Jason Dillaman (@dillaman).\r\n\r\n### Support or Contact\r\n\r\nFor any question feel free to contact Victor Araujo at ve.ar91@gmail.com.\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}